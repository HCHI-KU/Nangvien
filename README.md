# Nangvien
시스템 작동 방식 및 기술 상세 설명
본 프로젝트는 IoT 센서 데이터와 사용자 피드백을 기반으로 작동하는 AI 기반 에어컨 제어 시스템입니다. 시스템은 크게 데이터 수집, AI 모델링 및 최적화, 제어 및 피드백, **지속적 학습(Retraining)**의 4단계로 작동합니다.

1. 데이터 수집 및 전처리 (Data Acquisition & Preprocessing)
시스템은 실내외 환경 정보를 실시간으로 수집하여 제어의 기초 데이터로 활용합니다.

실내 환경 수집 (
rawdata_collect.py
):

Arduino/ESP32 기반의 IoT 디바이스가 실내 온도($T_{in}$)와 습도($H_{in}$)를 측정합니다.
측정된 데이터는 HTTP POST 요청을 통해 서버(/project/arduino_data)로 전송되며, 서버는 이 데이터를 JSON 형식으로 저장하고 즉시 분석 프로세스를 트리거합니다.
실외 환경 수집 (weather_util.py):

OpenWeatherMap API를 사용하여 실외 온도($T_{out}$)와 습도($H_{out}$) 데이터를 실시간으로 가져옵니다.
API 호출 실패 시, 과거 데이터나 계절적 평균값을 사용하는 Fallback 로직(safe_get_weather)이 구현되어 있어 시스템의 안정성을 보장합니다.
데이터 전처리:

수집된 데이터는 AI 모델이 학습하기 용이한 형태로 가공됩니다.
시간 특성 추출: 시간 정보를 $Sin/Cos$ 변환(hour_sin, hour_cos)하여 시간이 23시와 0시가 연속적임을 모델이 인식할 수 있도록 합니다.
파생 변수 생성: 설정 온도와 실내 온도의 차이($\Delta T = |T_{in} - T_{target}|$) 등을 계산하여 에너지 소비 예측의 핵심 지표로 사용합니다.
2. AI 모델링 (AI Modeling)
본 시스템은 에너지 효율성과 사용자 쾌적도를 동시에 만족시키기 위해 두 가지 머신러닝 모델을 운용합니다 (retrain_model.py, model_util.py).

A. 에너지 소비 예측 모델 (model_energy.pkl)
알고리즘: Linear Regression (선형 회귀)
목적: 특정 설정값(온도, 모드)으로 에어컨을 가동했을 때 예상되는 전력 소비량을 예측합니다.
입력 변수:
환경 변수: 실내외 온도/습도, 일사량(rad)
시간 변수: 시간($Sin/Cos$), 요일
제어 변수: 목표 온도($T_{target}$), 에어컨 모드(Cool, Dry, Fan), 전원 상태($F_{onoff}$)
파생 변수: $\Delta T$ (온도차)
B. 사용자 불쾌도 예측 모델 (model_discomfort.pkl)
알고리즘: Random Forest Regressor
목적: 현재 환경과 설정에서 사용자가 느낄 불쾌지수(또는 피드백 점수)를 예측합니다.
학습 데이터: 과거 사용자가 제출한 "춥다", "덥다", "적당하다" 등의 피드백 데이터를 정량화(-1, 0, 1)하여 학습합니다.
입력 변수: 실내외 온습도, 목표 온도, 시간 등.
3. 최적 제어 알고리즘 (Optimization & Control Logic)
시스템은 15분 주기 또는 센서 데이터 수신 시 즉시 최적값을 계산합니다 (app.py, rawdata_collect.py).

후보군 생성:

설정 가능한 목표 온도 범위(22°C ~ 28°C)와 운전 모드(Cool, Dry, Fan)의 모든 조합을 생성합니다.
비용 함수(Cost Function) 계산:

각 후보 조합에 대해 예측된 에너지 소비량($E$)과 불쾌도($D$)를 계산하고, 이를 가중 합산하여 비용(Cost)을 산출합니다. $$ Cost = w_1 \times E_{predicted} + w_2 \times D_{predicted} $$
($w_1, w_2$는 0.5로 설정하여 에너지 절약과 쾌적함의 균형을 맞춤)
동적 피드백 반영:

최근 1시간 내의 사용자 피드백을 분석하여 기본 목표 온도를 동적으로 보정합니다.
예: "춥다"는 피드백이 60% 이상일 경우 목표 온도를 +3°C 상향 조정.
최적값 선정 및 제어:

비용(Cost)이 가장 낮은 조합을 최적 설정값으로 선정합니다.
선정된 설정값(Mode, Temp, Fan)은 JSON 응답을 통해 Arduino로 전달되어 에어컨을 물리적으로 제어합니다.
4. 지속적 학습 및 자동화 (Continuous Learning & Automation)
시스템은 고정된 로직에 머물지 않고 데이터가 축적됨에 따라 스스로 진화합니다 (auto_retrain.py).

자동 재학습: 스케줄러가 15분마다 retrain_model.py를 실행합니다.
학습 파이프라인:
새로운 센서 데이터, 전력 소비 데이터, 사용자 피드백을 통합(load_and_combine_data).
최신 데이터를 반영하여 에너지 모델과 불쾌도 모델을 새로 학습(Fit).
모델 파일(.pkl)을 갱신하여 즉시 서비스에 반영.
데이터 관리: 오래된 데이터나 피드백은 주기적으로 정리(cleanup_now)하여 시스템 성능 저하를 방지합니다.
